<?xml version="1.0"?>

<!-- Ant file for building from the command line

     Not really a complete build file, just a start at replacing
     shell scripts with Ant

     Kay Kasemir
  -->
<project name="sns_css" default="all">
    <!-- Map all environment variables XYZ to ${env.XYZ} -->
    <property environment="env"/>

    <!-- Workspace from which sources are copied -->
    <property name="workspace_dir" value="/Kram/Eclipse/Workspace" />
    
    <!-- Build directory -->
    <property name="build_dir" value="build" />
	

    <!-- Zip all the source files -->
    <target name="check_vars" unless="env.VERSION">
        <fail message="VERSION is undefined"/>
    </target>
 	
    <!-- Remove all that might have been built previously -->
    <target name="clean">
        <delete dir="${build_dir}" />
    </target>

	
    <!-- Create build directory structure -->
    <target name="prepare">
        <mkdir dir="${build_dir}/plugins" />
        <mkdir dir="${build_dir}/features" />
    </target>


    <!-- Gather all the source files for building -->
    <target name="get_sources" depends="prepare">
        <!-- Plugins
             With 'overwrite' it seems much faster in case we really need
             to copy.
             If there's nothing to copy, it would have been faster without
             overwrite, i.e. check what needs to be done and then do nothing
          -->
        <copy todir="${build_dir}/plugins" overwrite="true">
             <fileset dir="${workspace_dir}" includesfile="plugins.list">
                 <exclude name="**/bin/**"/>
                 <exclude name="**/classes/**"/>
            </fileset>
        </copy>
        <!-- Features -->
        <copy todir="${build_dir}/features" overwrite="true">
             <fileset dir="${workspace_dir}" includesfile="features.list">
                <exclude name="**/bin/**"/>
                <exclude name="**/classes/**"/>
            </fileset>
        </copy>
    </target>


    <!-- Zip all the source files -->
    <target name="zip_sources" depends="check_vars">
    	<zip destfile="apps/sns_css_src_${env.VERSION}.zip">
             <fileset dir="${workspace_dir}" includesfile="plugins.list">
                 <exclude name="**/bin/**"/>
                 <exclude name="**/classes/**"/>
            </fileset>
             <fileset dir="${workspace_dir}" includesfile="features.list">
                <exclude name="**/bin/**"/>
                <exclude name="**/classes/**"/>
            </fileset>
        </zip>
    </target>


	<!-- Ideally, ant could drive the whole build, but it doesn't -->
    <target name="all">
        <echo>=== Complete ${name} rebuild - was not done by this ===</echo>
    </target>
</project>