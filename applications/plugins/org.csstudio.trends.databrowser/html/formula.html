<html>
<head>
<title>Data Browser</title>
</head>
<body>
<h2>Formula</h2>
The context menu of the <a href=plot_window.html>Plot Window</a>
as well as the <a href=config_view.html>Data Browser Config View</a>
allows the addition of formulas.

<h2>Formula Configuration</h2>
When adding a formula, or later selecting it in the Config View,
the Formula Configuration Dialog opens.
<p>
<img src="formula_cfg.png" width="831" height="436" alt="Formula Config">
<p>
<ol>
<li>The <u>Inputs</u> section lists all the PVs in the current configuration
    as possible inputs, and allows the assignment of shorter <u>Variable</u>
    names for use in the formula.
    Click on a Variable name to edit.
<li>Edit the formula, either by typing directly in the <u>Formula</u>
    text field, or by using the <u>Functions</u> and <u>Basic Calculations</u>.
<li>The <u>Parsed Formula</u> info on the bottom will show basic error messages.
</ol>

<h3>Basic Calculations</h3>
... follow the behavior of most pocket calculators.

<h3>Functions</h3>
<ul>
<li>All the functions shown in the dialog but not specifically mentioned in
    here take one argument, for example <code>sin(x)</code>.
<li><code>atan2(y,x)</code> takes two arguments and computes
     <code>atan(y/x)</code> with added consideration of the four possible
     quadrants.
<li>All trigonometric functions operate in radians.
    The functions <code>toDegrees</code> resp. <code>toRadians</code>
    can be used to convert, for example:
    <code>toDegrees(sin(x+toRadians(30)))</code>.
<li><code>min</code>, <code>max</code> take one or more arguments,
    for example <code>min(x, y, 1)</code>.
<li><code>^</code> as in <code>x^y</code>
    raises <code>x</code> to the power of <code>y</code>.
<li><code>? :</code> is an if-then-else operator,
    for example <code>x > 0 ? x^2 : 0</code>.
<li>Boolean operations 
    <code>==</code>,
    <code>!=</code>,
    <code>&gt;</code>,
    <code>&gt;=</code>,
    <code>&lt;</code>,
    <code>&lt;=</code>
    are supported, but only accessible by directly typing them into the Formula.
<li><code>rnd(x)</code> provides a random number <code>[0...x[</code>.
<li><code>PI</code>, <code>E</code> are predefined constants.
</ul>


<h2>Formula Behavior at Runtime</h2>
The formula is evaluated based on the data shown in the plot,
because this allows seamless operation on archived as well as life samples
from different sources.
<p>
<img src="formula_runtime.png" width="627" height="291" alt="Formula in Plot">
<p>
On the downside, the data quality of computed samples is always considered
"interpolated" and limited to the time stamp granularity of what's 
visible in the plot.
When trying to export data from both the archive and a formula,
a corresponding warning points this out.

</body>
</html>