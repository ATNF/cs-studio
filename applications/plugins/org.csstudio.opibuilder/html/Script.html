<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=Cp1252"/>
    <link rel="stylesheet" href="default.css" type="text/css" />
    <title>
      Script
    </title>
  </head>
  <body>

    <h1>
      Script
    </h1>
    <p>
To obtain more flexible hehaviors than just setting from properties sheet, you can attach scripts to widgets.
The script is JavaScript file, but more than plain javascript file, you can set PVs as input and set the properties of the widget in the script. The script execution is triggered by the PV inputs.
 That means, any PV value change will trigger the execution of the script. In the script, the value or severity of the input PVs are accessible. 
</p>
<h3>
Steps to attach scripts to a widget:
</h3>
<ol>
	<li>Select "Scripts" property in the property sheet view.
	</li>
	<li>In the "Attach Scripts" Dialog, you can add more than one script. For each script, you can specify more than one PV as the input.
	</li>
	<li>Run OPI to see the result.
	</li>
</ol>

  <h3>Access input PVs and the widget</h3>
  <p>The most common things in the script would be read the PV value and set the properties of the widget.</p>
	<h4>Read PV Value
	</h4>
	<p>The input PVs are accessible from pvArray, in which the PVs have the same order as the input.</p>
	<pre class="example_code">importPackage(Packages.org.csstudio.platform.data);
var value0 = ValueUtil.getDouble(pvArray[0].getValue());
var value1 = ValueUtil.getDouble(pvArray[1].getValue()); </pre>
	<h4>Write PV Value
	</h4>
	<p>Only the input PVs are writable in the script.</p>
	<pre class="example_code">importPackage(Packages.org.csstudio.platform.data);
pvArray[0].setValue(0);	</pre>


	<h4>Set Widget Properties in Script
	</h4>
	<p>The property could be set by setPropertyValue(prop_id, value) function.</p>
	<pre class="example_code">widgetController.setPropertyValue("x", 20);</pre>
<h3>Other Utility Functions</h3>
<p>The script will be executed with the whole Eclipse and CSS libraries, so that all the libraries can be accessed in the script.
Followings are some examples:</p>
<h4>Color</h4>
<h5>Use Predefined Color</h5>
<pre class="example_code">importPackage(Packages.org.csstudio.platform.ui.util);
var RED = CustomMediaFactory.COLOR_RED;
var ORANGE = CustomMediaFactory.COLOR_ORANGE;
var GREEN = CustomMediaFactory.COLOR_GREEN;
widgetController.setPropertyValue("foreground_color", ORANGE);
</pre>
<h5>Use RGB Color</h5>
<pre class="example_code">importPackage(Packages.org.eclipse.swt.graphics);
var RED = new RGB(0,0,0);
RED.red = 255;
RED.green = 0;
RED.blue = 0;
widgetController.setPropertyValue("foreground_color", RED);
</pre>
<h4>Dialog</h4>
<pre class="example_code">importPackage(Packages.org.eclipse.jface.dialogs);
MessageDialog.openInformation(
			null, "Dialog from JavaScript", "Button Pushed.");</pre>
  <p></p>
  </body>
</html>
