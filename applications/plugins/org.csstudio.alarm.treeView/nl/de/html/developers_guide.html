<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">

<html>
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
	<title>Alarm Tree Developer's Guide</title>
</head>

<body>
<h1>Alarm Tree Developer's Guide</h1>
<p>Dieses Dokument beschreibt die Implementation des Alarm-Tree-Plugins.
	Der Alarm-Tree liest seine Struktur von einem LDAP-Directory und empfängt Updates
	der Alarmzustände über JMS. Alarmzustände werden hierarchisch fortgepflanzt,
	so dass Mutterknoten den schwersten Alarmzustand ihrer Kinder anzeigen.</p>
<p>Benutzeraktionen im Baum werden durch Auswahl von Knoten und Starten von Aktionen 
	aus dem Kontextmenu des Baums ausgeführt..</p>
<h2>Initialization</h2>
<p>Wenn  eine View erzeugt wird, verbindet das Plug-In zuerst mit den JMS-Servern.
	Wenn die Verbindung steht, wird die Struktur des Alarm-Trees vom LDAP-Server gelesen.
	Währen des Lesesn der Baumstruktur empfangenen JMS-Nachrichten werden gequeuet und 
	erst verarbeitet, nachdem das Lesen abgeschlossen ist. Einzelheiten siehe im Quellcode.</p>
<p>Die Verbindung mit JMS und das Lesen des LDAP-Baums werden im Hintergrund ausgeführt,
	damit das Benutzer-Interface nicht "einfriert". Der JMS-Verbindungs-Job startet (schedules)
	den LDAP-Lese-Job, sobald die JMS-Verbindung aufgebaut ist; und ein Listener-Prozess, der mit dem
	LDAP-Reader verbunden ist, aktualisiert das User-Interface und setzt den Tree als Ziel für
	Alarm-Nachrichten, die über JMS empfangen werden, wenn der LDAP-Lese-Job getan ist.</p>
<h2>Propagating severity changes</h2>
<p>Alarm-Zustände werden vom LDAP-Reader und vom JMS-Listener auf die Blatt-Knoten gesetzt.
Die Blatt-Knoten sind vom Typ <code>ProcessVariableNode</code> und repräsentieren PV-Records.
Wenn ihr Alarm-Zustand geändert wird, 
(s. Methoden <code>setActiveAlarm</code> und <code>setHighestUnacknowledgedAlarm</code>),
verständigen sie ihre Eltern-Knoten über diese Änderung. Der Eltern-Knoten checkt 
dann, on es nötig ist, seinen Alarmzustand zu ändern, verständigt, wenn nötig, seinen Eltern-Knoten,
u.s.w., bis der Baum abgearbeitet ist.
</p>
<h2>Context menu actions</h2>
<p>Benutzer können Aktionen mit Hilfe des Tree-Kontext-Menus ausführen. 
Die Aktionen werden in <code>AlarmTreeView#makeActions</code> erzeugt und
in Instanzen-Feldern von <code>AlarmTreeView</code> gespeichert.
Das Kontext-Menu wird in der <code>initializeContextMenu</code>-Methode
erzeugt und in der <code>fillContextMenu</code>-Methode mit Items gefüllt.
Diese Methode fügt auf Grundlage der aktuellen Auswahl Menu-Items hinzu.
</p>
<p>Beispielsweise wird die &quot;Run alarm display&quot;-Aktion nur hinzugefügt,
	wenn genau ein PV-Node ausgewählt ist (d.h. die Aktion ist nicht verfügbar, wenn mehrere
	Nodes ausgewählt sind oder wenn der ausgewählte Knoten kein Record, sondern ein Mutter-Knoten ist) :</p>
<pre>if (selection.size() == 1
        && selection.getFirstElement() instanceof ProcessVariableNode) {
    menu.add(runCssAlarmDisplayAction);
}
</pre>
<p>Der <code>AlarmTreeView</code> lauscht auch auf Auswahl-Änderungen und aktiviert/disaktiviert 
	die Aktionen, die auf den ausgewählten Knoten beruhen.
	Beispielsweise wird die &quot;Run alarm display&quot;-Aktion disaktiviert
	wenn kein Alarm-Display für den ausgewählten Knoten konfiguriert ist.
	
</p>
<p>Um zusätzliche Items zum Kontext-Menu hinzuzufügen, muss man :
</p>
<ul>
<li>die Aktion, die man als eine Subklasse von <code>org.eclipse.jface.action.Action</code>
	laufen lassen möchte, implementieren.</li>
<li>die Aktion in der <code>fillContextMenu</code>-Methode zum Kontextmenu hinzufügen.</li>
<li>optional Code zur <code>selectionChanged</code>-Methode hinzufügen, um die Aktion, die
	auf der aktuellen Auswahl beruht, zu aktivieren oder zu disaktivieren.</li>
</ul>
</body>
</html>